{#
  Navigation is the most complex part of this site. I've used a single template for sections and pages, setting the current page/section state on the `this_page` variable to simplify programming.

  This creates 3 links on any section or page: Previous, Top and Next.

  * Previous: links to a lighter page or the parent section index.
  * Top: links straight to the home page.
  * Next: links into the first child page of a section or the next sibling page within a section. If the current page is the last page in a section, it links to the next section index if any exists.
#}
{% if page %}
  {% set this_page = page %}
{% else %}
  {% set this_page = section %}
{% endif %}
{% set parent = get_section(path=this_page.ancestors | last) %}

{# previous link #}
{% if page and page.lighter %}
  {% set prev_page = page.lighter %}
{% elif parent %}
  {% set prev_page = parent %}
{% endif %}


<footer>
  <nav>
    <ul>
      <li>
        <a href="{{ prev_page.permalink | safe }}">
          &larr; {{ prev_page.title }}
        </a>
      </li>
      <li>
        <a href="{{ get_url(path="@/_index.md") }}">
          Top
        </a>
      </li>

      {% if this_page.heavier %}
      {# next sibling #}
        <li>
          <a href="{{ this_page.heavier.permalink | safe }}">
            {{ this_page.heavier.title }} &rarr;
          </a>
        </li>
        {% elif this_page.pages %}
          {# First child page if this_page is a section #}
          {% set next_page = this_page.pages | first %}
          <li>
            <a href="{{ next_page.permalink | safe }}">
              {{ next_page.title }} &rarr;
            </a>
          </li>
        {% elif parent.ancestors %}
          {# Find the next section index if any exists #}
          {% set grandparent = get_section(path=parent.ancestors | last) %}
          {% set grandparent_length = grandparent.subsections | length %}
          {% for section_path in grandparent.subsections %}
            {% if parent.path in section_path %}
              {% set next_page = get_section(path=grandparent.subsections | nth(n=loop.index)) %}
              {% if next_page %}
                <li>
                  <a href="{{ next_page.permalink | safe }}">
                    {{ next_page.title }} &rarr;
                  </a>
                </li>
                {% break %}
              {% endif %}
            {% endif %}
          {% endfor %}
      {% endif %}
    </ul>
  </nav>
</footer>
